!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class s{constructor({url:t,width:e=null}){this.url=t,this.width=e,this.img,this.height,this.canvas,this.ctx}init(){return this.setImg().then(t=>(console.log(t),this.setCachedImg(),"Created cached image and got its data")).catch(t=>console.log(t))}setImg(){return new Promise((t,e)=>{this.img=new Image,this.img.src=this.url,this.img.onload=(e=>t(`"${this.img.src}" loaded`)),this.img.onerror=(t=>e(`Error loading "${this.img.src}"`))})}setCachedImg(){this.setImgSize(),this.canvas=Object.assign(document.createElement("canvas"),{width:this.width,height:this.height}),this.ctx=this.canvas.getContext("2d"),this.ctx.drawImage(this.img,0,0,this.width,this.height)}setImgSize(){const t=this.img.height/this.img.width;this.width&&this.width<window.innerWidth?this.height=this.width*t:window.innerHeight/window.innerWidth<t?(this.width=window.innerHeight/t,this.height=window.innerHeight):(this.width=window.innerWidth,this.height=window.innerWidth*t)}}class n{constructor(t,e,i,s=255){this.r=t,this.g=e,this.b=i,this.a=s}reset(){this.r=this.initial.r,this.g=this.initial.g,this.b=this.initial.b,this.a=this.initial.a}get rgb(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toBW(t="luminosity"){let e;switch(t){case"luminosity":e=Math.round(.2126*this.r+.7152*this.g+.0722*this.b);break;case"average":e=Math.round((this.r+this.g+this.b)/3);break;case"lightness":e=Math.round((Math.max(this.r,this.g,this.b)+Math.max(this.r,this.g,this.b))/2);break;default:throw Error(`Incorrect method: "${t}"`)}this.r=this.g=this.b=e}rgbToHsl(){let t=this.r,e=this.g,i=this.b;t/=255,e/=255,i/=255;const s=Math.max(t,e,i),n=Math.min(t,e,i);let h,a,o=(s+n)/2;if(s==n)h=a=0;else{let r=s-n;switch(a=o>.5?r/(2-s-n):r/(s+n),s){case t:h=(e-i)/r+(e<i?6:0);break;case e:h=(i-t)/r+2;break;case i:h=(t-e)/r+4}h/=6}return[h=Math.round(360*this.h),a=Math.round(100*this.s),o=Math.round(100*this.l)]}}class h{constructor(t){this.ctx=t,this.width=this.ctx.canvas.width,this.height=this.ctx.canvas.height,this.imgData=this.ctx.getImageData(0,0,this.width,this.height),this.paletteFactor=6,this.palettes=[],this.imageColors=[],this.setColorsData(),this.setPaletteData()}divideColorsByRange(t){let e=255,i=0,s=255,n=0,h=255,a=0;t.forEach(t=>{i=Math.min(i,t.r),e=Math.max(e,t.r),n=Math.min(n,t.g),s=Math.max(s,t.g),a=Math.min(a,t.b),h=Math.max(h,t.b)});const o=e-i,r=s-n,l=h-a;let d;d=l>=o&&l>=r?"b":r>=o&&r>=l?"g":"r";const c=t.slice().sort((t,e)=>e[d]-t[d]),p=Math.floor(c.length/2);return[c.slice(0,p),c.slice(p,c.length)]}setPaletteData(){let t=this.divideColorsByRange(this.imageColors);for(let e=0;e<this.paletteFactor;e++){let e=[],i=[];t.forEach(t=>{i.push(this.averageColors(t));const[s,n]=this.divideColorsByRange(t);e.push(s),e.push(n)}),this.palettes.push(i),t=e}}setColorsData(){for(let t=0;t<this.pixelsData.length;t+=4){const e=new n(...this.pixelsData.slice(t,t+4));this.imageColors.push(e)}}averageColors(t){let e=0,i=0,s=0;t.forEach(t=>{e+=t.r*t.r,i+=t.g*t.g,s+=t.b*t.b});const h=Math.round(Math.sqrt(e/t.length)),a=Math.round(Math.sqrt(i/t.length)),o=Math.round(Math.sqrt(s/t.length));return new n(h,a,o)}get pixelsData(){return this.imgData.data}}class a{constructor({ctx:t,data:e}){this.ctx=t,this.data=e,this.width=window.innerHeight<window.innerWidth?window.innerHeight:window.innerWidth,this.factor=2,this.cellSizes=[],this.offsets=[],this.rowNums=[],this.setPaletteSizes()}setPaletteSizes(){this.data.forEach(t=>{const e=Math.round(Math.sqrt(t.length)),i=Math.floor(this.width/e),s=Math.floor((this.width-i*e)/2);this.rowNums.push(e),this.cellSizes.push(i),this.offsets.push(s)})}changeCanvasSize(){this.ctx.canvas.width===this.width&&this.ctx.canvas.width===this.ctx.canvas.height||(this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.width)}clear(){this.ctx.fillStyle="#fff",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.strokeStyle="#ccc",this.ctx.strokeRect(0,0,this.width,this.width)}draw(){this.changeCanvasSize(),this.clear(),this.ctx.save(),this.ctx.translate(this.offsets[this.factor],this.offsets[this.factor]),this.data[this.factor].forEach((t,e)=>{const i=e%this.rowNums[this.factor]*this.cellSizes[this.factor],s=Math.floor(e/this.rowNums[this.factor])*this.cellSizes[this.factor];this.ctx.fillStyle=t.rgb,this.ctx.fillRect(i,s,this.cellSizes[this.factor],this.cellSizes[this.factor])}),this.ctx.restore()}copyColorsToClipboard(){console.log(this.data,this.factor);const t=document.createElement("textarea");t.value=this.data[this.factor].map(t=>t.rgb).join(", "),t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}function o(t,e=null,i=null){const s=document.createElement(t);return e&&l(s,e),i&&d(s,i),s}function r(t,e=null,i=null){const s=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&l(s,e),i&&d(s,i),s}function l(t,e){Object.keys(e).forEach(i=>{switch(i){case"classes":e[i].forEach(e=>t.classList.add(e));break;case"textContent":t.textContent=e[i];break;case"selected":t.selected=e[i];default:t.setAttribute(i,e[i])}})}function d(t,e){e.forEach(e=>t.appendChild(e))}class c{constructor({parent:t,title:e,content:i}){this.title=e,this.content=i,this.node=null,this.parent=t,this.render()}render(){this.node=o("div",{id:"description"},[o("h1",{textContent:this.title},null)]),this.content.forEach(t=>{const e=o("p",{textContent:t},null);this.node.appendChild(e)}),this.parent.node.appendChild(this.node)}}class p{constructor({parent:t,prop:e,scope:i=null,updateFn:s=null,label:n,options:h,value:a}){this.prop=e,this.scope=i,this.updateFn=s,this.label=n,this.options=h,this.value=a,this.parent=t,this.node=null,this.input=null,this.render(),this.eventListener()}render(){const t=this.options.map(t=>o("option",{value:t,textContent:t,selected:t===this.value}));this.input=o("select",{id:this.prop},t),this.node=o("div",{classes:["select"]},[o("label",{textContent:this.label,for:this.prop},null),o("br"),this.input]),this.parent.node.appendChild(this.node)}eventListener(){this.input.addEventListener("change",this.eventHandler.bind(this))}eventHandler(t){this.value=this.input.value,this.scope?this.scope[this.prop]=this.value:this.parent.scope[this.prop]=this.value,this.updateFn?this.updateFn():this.parent.updateFn()}}class u{constructor({parent:t,label:e,scopeOptions:i,updateFn:s=null,type:n="image"}){this.scopeOptions=i,this.updateFn=s,this.type=n,this.label=e,this.parent=t,this.node=null,this.input=null,this.render(),this.eventListener()}render(){this.input=o("input",{type:"file"},null),this.node=o("label",{textContent:this.label,id:this.label.replace(/\s/g,"-"),classes:["file-btn"]},[this.input]),this.parent.node.appendChild(this.node)}eventListener(){this.input.addEventListener("change",this.eventHandler.bind(this))}eventHandler(t){const e=new FileReader;e.onload=(t=>{const e="json"===this.type?JSON.parse(t.target.result):t.target.result,i=this.scopeOptions?{[this.scopeOptions]:e}:e;this.updateFn?this.updateFn(i):this.parent.updateFn(i)}),"image"===this.type&&e.readAsDataURL(t.target.files[0]),"json"===this.type&&e.readAsText(t.target.files[0])}}class g{constructor({parent:t,label:e,fn:i}){this.fn=i,this.label=e,this.parent=t,this.node=null,this.render(),this.eventListener()}render(){this.node=o("button",{textContent:this.label,id:this.label.replace(/\s/g,"-")},null),this.parent.node.appendChild(this.node)}eventListener(){this.node.addEventListener("click",this.eventHandler.bind(this))}eventHandler(t){this.fn()}}class m{constructor({parent:t,max:e,min:i,step:s=1,value:n,prop:h,scope:a=null,updateFn:o=null,label:r}){this.prop=h,this.scope=a,this.updateFn=o,this.label=r,this.max=e,this.min=i,this.step=s,this.value=n,this.parent=t,this.node=null,this.input=null,this.output=null,this.render(),this.eventListener()}render(){this.input=o("input",{type:"range",id:this.prop,max:this.max,min:this.min,step:this.step,value:this.value}),this.output=o("output",{textContent:this.value}),this.node=o("div",{classes:["slider"]},[o("label",{for:this.prop,textContent:`${this.label} â€” `}),this.output,o("br"),this.input]),this.parent.node.appendChild(this.node)}eventListener(){this.input.addEventListener("change",this.eventHandler.bind(this))}eventHandler(t){const e=this.input.valueAsNumber;this.output.textContent=e,this.scope?this.scope[this.prop]=e:this.parent.scope[this.prop]=e,this.updateFn?this.updateFn():this.parent.updateFn()}}class v{constructor({parent:t,prop:e,scope:i=null,updateFn:s=null,value:n,label:h}){this.prop=e,this.scope=i,this.updateFn=s,this.label=h,this.value=n,this.node=null,this.parent=t,this.render(),this.eventListener()}render(){this.node=o("button",{textContent:this.label,id:this.prop,classes:["toggle"]},null),this.value||this.node.classList.add("deactivated"),this.parent.node.appendChild(this.node)}eventListener(){this.node.addEventListener("click",this.eventHandler.bind(this))}eventHandler(t){this.node.classList.toggle("deactivated"),this.value=!this.value,this.scope?this.scope[this.prop]=this.value:this.parent.scope[this.prop]=this.value,this.updateFn?this.updateFn():this.parent.updateFn()}}class w{constructor({parent:t,fn:e,updateFn:i=null,label:s}){this.fn=e,this.updateFn=i,this.label=s,this.node=null,this.parent=t,this.render(),this.eventListener()}render(){this.node=o("button",{textContent:this.label,id:this.label.replace(/\s/g,"-")},null),this.parent.node.appendChild(this.node)}eventListener(){this.node.addEventListener("click",this.eventHandler.bind(this))}eventHandler(t){this.fn(),this.updateFn?this.updateFn():this.parent.updateFn()}}class b{constructor({parent:t,select:e,emptyMessage:i="No options"}){this.emptyMessage=i,this.select=e.input,this.selectValue=this.select.value,this.parent=t,this.node=null,this.updateFn=this.parent.updateFn,this.scope=this.parent.scope,this.groups={},this.render(),this.eventListener()}createGroup({name:t,nodes:e}){const i=o("div",{id:`section-${t}`},e.map(t=>t.node));this.groups[t]=i,this.render()}render(){this.groups[this.selectValue]||(this.groups[this.selectValue]=o("div",{classes:["section-empty"]},[o("p",{textContent:this.emptyMessage})])),this.node?this.node.replaceChild(this.groups[this.selectValue],this.node.firstElementChild):(this.node=o("div",{classes:["section-container"]},[this.groups[this.selectValue]]),this.parent.node.appendChild(this.node))}eventListener(){this.select.addEventListener("change",this.eventHandler.bind(this))}eventHandler(t){this.selectValue=this.select.value,this.render()}}class f{constructor({showOnLoad:t=!0,updateFn:e,scope:i}){this.showOnLoad=t,this.updateFn=e,this.scope=i,this.componentTypes={description:c,select:p,toggleButton:v,slider:m,fileButton:u,downloadButton:g,section:b,button:w},this.node=null,this.menuBtn=null,this.closeBtn=null,this.reset(),this.render(),this.eventListener()}reset(){const t=document.querySelector("#ui"),e=document.querySelector("#menu");t&&t.parentNode.removeChild(t),e&&e.parentNode.removeChild(e)}createComponent(t,e=null){return e.parent||(e=Object.assign({},{parent:this},e)),new this.componentTypes[t](e)}render(){this.menuBtn=r("svg",{width:45,height:45,id:"menu"},[r("rect",{x:10,y:10,width:25,height:5,fill:"#000"}),r("rect",{x:10,y:20,width:25,height:5,fill:"#000"}),r("rect",{x:10,y:30,width:25,height:5,fill:"#000"})]),this.closeBtn=o("button",{textContent:"[ close ]",id:"close"},null),this.node=o("div",{id:"ui"},[this.closeBtn]),this.showOnLoad||this.node.classList.add("moverIzq"),document.body.appendChild(this.menuBtn),document.body.appendChild(this.node)}addSeparator(){const t=document.createElement("hr");this.node.appendChild(t)}eventListener(){this.menuBtn.addEventListener("click",this.openEventHandler.bind(this)),this.closeBtn.addEventListener("click",this.closeEventHandler.bind(this))}openEventHandler(t){this.node.classList.remove("moverIzq")}closeEventHandler(t){this.node.classList.add("moverIzq")}addSignature(){const t=r("svg",{width:50,height:50,viewBox:"0 0 13.229166 13.229167"},[r("rect",{y:"-7.7716e-16",width:"13.229",height:"13.229",fill:"#aaa",style:"paint-order:normal"},null),r("g",{fill:"#fff"},[r("path",{d:"m5.7496 1.641v6.8601c0 0.75774-0.61427 1.372-1.372 1.372-0.63771 0-1.174-0.43495-1.3278-1.0245l-1.2898 1.2898c0.54581 0.87079 1.514 1.4497 2.6176 1.4497 1.7049 0 3.087-1.3821 3.087-3.0871v-6.8601z"},null),r("path",{d:"m8.3907 5.4141v6.1741c1.701-5e-3 3.0785-1.385 3.0785-3.0871 0-1.7021-1.3775-3.0824-3.0785-3.087z"},null),r("path",{d:"m8.3907 1.641v3.43c0.94414-4e-3 1.7084-0.77004 1.7084-1.715s-0.76428-1.7115-1.7084-1.715z"},null)])]),e=o("a",{href:"https://github.com/jblanper",target:"_blank",id:"signature"},[o("span",{textContent:"by"}),t]);this.node.appendChild(e)}}class x{constructor(t){this.ctx=t,this.backgroundColor="#fff",this.imageUrl="./photo.jpg",this.drawingType="image"}init({imageUrl:t=this.imageUrl}={}){return this.clear(),this.drawingType="image",this.imgToDraw=new s({url:t}),this.imgToAnalyze=new s({url:t,width:300}),Promise.all([this.imgToDraw.init(),this.imgToAnalyze.init()]).then(t=>(t.forEach(t=>console.log(t)),this.imageAnalyzer=new h(this.imgToAnalyze.ctx),this.palette=new a({ctx:this.ctx,data:this.imageAnalyzer.palettes}),this.setBindings(),this.draw(),"Sketch initialized"))}setBindings(){const t=new f({showOnLoad:!0,updateFn:this.draw.bind(this),scope:this});t.createComponent("description",{title:"Get a palette!",content:['Upload an image and generate a palette with the most representative colors. Select the option "palette" below to get the palette. Use the slider to determine the number of colors. Enjoy!']}),t.addSeparator();const e=t.createComponent("select",{prop:"drawingType",label:"draw options",options:["image","palette"],value:this.drawingType});t.addSeparator();const i=t.createComponent("section",{select:e,emptyMessage:"No options for this section"}),s=t.createComponent("slider",{parent:i,label:"palette factor",max:5,min:0,prop:"factor",scope:this.palette,value:this.palette.factor}),n=t.createComponent("button",{label:"copy colors",fn:this.palette.copyColorsToClipboard.bind(this.palette)});i.createGroup({name:"palette",nodes:[s,n]}),t.addSeparator(),t.createComponent("fileButton",{scopeOptions:"imageUrl",updateFn:this.init.bind(this),label:"upload IMG"}),t.createComponent("downloadButton",{fn:this.setPng.bind(this),label:"download IMG"}),t.addSignature()}setPng(){const t=Object.assign(document.createElement("canvas"),{width:this.ctx.canvas.width,height:this.ctx.canvas.height}).getContext("2d");t.drawImage(this.ctx.canvas,0,0);const e=t.canvas.toDataURL("image/png");window.open().document.write(`<img src="${e}" />`)}drawImage(){this.ctx.canvas.width=this.imgToDraw.width,this.ctx.canvas.height=this.imgToDraw.height,this.ctx.drawImage(this.imgToDraw.canvas,0,0,this.imgToDraw.width,this.imgToDraw.height)}clear(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}draw(){switch(this.drawingType){case"image":this.drawImage();break;case"palette":this.palette.draw()}}}!function(){const t=document.querySelector("#sketch").getContext("2d");new x(t).init().then(t=>console.log(t)).catch(t=>console.log(t))}()}]);